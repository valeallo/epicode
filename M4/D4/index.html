<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <style>
        :root {
            --jumbotron-padding-y: 3rem;
        }

        .jumbotron {
            padding-top: var(--jumbotron-padding-y);
            padding-bottom: var(--jumbotron-padding-y);
            margin-bottom: 0;
            background-color: #fff;
        }

        @media (min-width: 768px) {
            .jumbotron {
                padding-top: calc(var(--jumbotron-padding-y) * 2);
                padding-bottom: calc(var(--jumbotron-padding-y) * 2);
            }
        }

        .jumbotron p:last-child {
            margin-bottom: 0;
        }

        .jumbotron-heading {
            font-weight: 300;
        }

        .jumbotron .container {
            max-width: 40rem;
        }

        footer {
            padding-top: 3rem;
            padding-bottom: 3rem;
        }

            footer p {
                margin-bottom: .25rem;
            }

        .box-shadow {
            box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05);
        }

        .hidden {
            display: none;
        }

        #hidden {
            visibility: hidden;
        }

        #inCart {
            background-color: lightblue;
        }

        #cart{
            background-color: #cef1c0;
        }

    </style>
</head>
<body>
    <header>
        <div class="collapse bg-dark" id="navbarHeader">
            <div class="container">
                <div class="row">
                    <div class="col-sm-8 col-md-7 py-4">
                        <h4 class="text-white">About</h4>
                        <p class="text-muted">Add some information about the album below, the author, or any other background context. Make it a few sentences long so folks can pick up some informative tidbits. Then, link them off to some social networking sites or contact information.</p>
                    </div>
                    <div class="col-sm-4 offset-md-1 py-4">
                        <h4 class="text-white">Contact</h4>
                        <ul class="list-unstyled">
                            <li><a href="#" class="text-white">Follow on Twitter</a></li>
                            <li><a href="#" class="text-white">Like on Facebook</a></li>
                            <li><a href="#" class="text-white">Email me</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="navbar navbar-dark bg-dark box-shadow">
            <div class="container d-flex justify-content-between">
                <a href="#" class="navbar-brand d-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                    <strong>Album</strong>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </header>

    <main role="main">

        <section class="jumbotron text-center">
            <div class="container">
                <h1 class="jumbotron-heading">Library</h1>

                <form id="form" onsubmit="return false;">
                    <input type="text" id="userInput" />
                    <input type="submit" onclick="searchBooks();" />
                </form>
                </br>
                <a href="#" class="btn btn-primary my-2" onclick="() => { console.log(cart) }">Load Cart</a>
                <a href="#" class="btn btn-secondary my-2" onclick="createcard()">Load Secondary Images</a>
            </div>
        </section>

        <div class="album py-5 bg-light">
            <div class="accordion" id="accordionExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Carrello
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div class="container">
                                <div class="row" id="cart">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="accordion" id="accordionExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Risultati ricerca
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div class="container">
                                <div class="row" id="results">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container">
                <h2 style="margin: 3em 0; border-bottom: 2px; border-bottom-style: dotted;">ELENCO LIBRI</h2>
                <div class="row card_container">


                </div>
            </div>
        </div>

</main>

    <footer class="text-muted">
        <div class="container">
            <p class="float-right">
                <a href="#">Back to top</a>
            </p>
            <p>Album example is &copy; Bootstrap, but please download and customize it for yourself!</p>
            <p>New to Bootstrap? <a href="../../">Visit the homepage</a> or read our <a href="../../getting-started/">getting started guide</a>.</p>
        </div>
    </footer>
    <script>
        let cart = [];
        let removedbooks = [];
        let allbooks = [];
        let librarycontainer = document.querySelector(".card_container");
        let cartcontainer = document.querySelector("#cart");
        let searchcontainer = document.querySelector("#results");


        function addToCart(asin, object, k) {
            let thiscard = document.getElementById("cardBody" + asin + k);
            let thisBtn = document.getElementById("addbutton" + asin + k);
            if (!cart.includes(object)) {
                thiscard.style.backgroundColor = "lightblue";
                thisBtn.innerHTML = "Remove From Cart";
                cart.push(object);
                cartcontainer.innerHTML = "";         
                printLibrary(cart, cartcontainer, 2)
            }
            else {
                thiscard.style.backgroundColor = "white";
                thisBtn.innerHTML = "Add to Cart";
                let index = cart.indexOf(object);
                if (index !== -1) {
                    cart.splice(index, 1);
                    cartcontainer.innerHTML = "";
                    printLibrary(cart, cartcontainer, 2)
                }

            }

        }

        function skipBook(asin, object, k) {
            let thiscard = document.getElementById("cardBody" + asin + k);
            let thiscolumn = document.getElementById("thiscolumn" + asin + k);
            if (!cart.includes(asin)) {
                removedbooks.push(asin);
                thiscolumn.remove();
            }
            else {
                thiscard.style.backgroundColor = "white";
                this.innerHTML = "Add to Cart";
                let index = cart.indexof(object);
                if (index !== -1) {
                    cart.splice(index, 1);   
                }
            }

        }

        //function loadCart() {
        //    let cartContainer = document.getElementById("cart");
        //    cartContainer.innerHTML = "";
        //    let cartString = cartTitles.toString();
        //    cartContainer.innerHTML = cartString;
        //}
        

        function createcard(object, container, k) {
            //let container = document.querySelector(".card_container");
            let column = document.createElement("div");
            column.className = "col-2";
            column.id = "thiscolumn" + object.asin + k;
            container.appendChild(column);
            let card = document.createElement("div");
            card.className = "card mb-4 box-shadow";
            card.id = "card" + object.asin + k;
            column.appendChild(card);
            let img = document.createElement("img");
            img.src = object.img;
            img.classname = "card-img-top book_cover";
            card.appendChild(img);
            let cardBody = document.createElement("div");
            cardBody.className = "card-body";
            cardBody.id = "cardBody" + object.asin + k;
            card.appendChild(cardBody);
            let cardText = document.createElement("h6");
            cardText.className = "card-text";
            cardText.innerHTML = object.title;
            cardBody.appendChild(cardText);
            let bookprice = document.createElement("p");
            bookprice.className = "card-text";
            bookprice.innerHTML = object.price + " $";
            cardBody.appendChild(bookprice);
            let book_category = document.createElement("small");
            book_category.className = "text-muted"
            book_category.innerHTML = object.category;
            cardBody.appendChild(book_category);
            let cardFooter = document.createElement("div");
            cardFooter.className = "d-flex justify-content-between align-items-center";
            cardBody.appendChild(cardFooter);
            let btngroup = document.createElement("div");
            btngroup.className = "btn-group"
            cardFooter.appendChild(btngroup);
            let skipBtn = document.createElement("button");
            skipBtn.type = "button";
            skipBtn.className = "btn btn-sm btn-outline-secondary";
            skipBtn.innerHTML = "Skip";
            btngroup.appendChild(skipBtn);
            skipBtn.onclick = function () {
                skipBook(object.asin, object, k);
            }
            let addToCartBtn = document.createElement("button");
            addToCartBtn.type = "button";
            addToCartBtn.className = "btn btn-sm btn-outline-secondary";
            addToCartBtn.innerHTML = "Add to Cart";
            addToCartBtn.id = "addbutton" + object.asin + k;
            addToCartBtn.onclick = function () {
                addToCart(object.asin, object, k);
            }
            btngroup.appendChild(addToCartBtn);   
        }

        
        async function loadLibrary() {
            let res = await fetch("https://striveschool-api.herokuapp.com/books");
            res = await res.json();
            res.forEach(
                (el) => {
                    allbooks.push(el);
                    //createcard(el, librarycontainer);
                    
                }
                
            )
            printLibrary(allbooks, librarycontainer, 1)
        }       
        loadLibrary();


        function printLibrary(array, container, k) {
            for (el of array) {
                createcard(el, container, k)
            }
        }

        
        

        function searchBooks() {
            let input = document.getElementById("userInput").value;
            input = input.toLowerCase();
            console.log(input);
            let search_results = [];
            for (i = 0; i < allbooks.length; i++) {
                if (!allbooks[i].title.toLowerCase().includes(input)) {
                    continue;
                    //console.log("no results");
                }
                else {
                    search_results.push(allbooks[i]);
                    
                }
            }
            console.log(search_results);
            searchcontainer.innerHTML = "";
            printLibrary(search_results, searchcontainer, 3)

        }




        


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
</body>
</html>
<!--# Esercizi

## Negozio di libri EPICO 📚

Sei incaricato di creare la funzione di carrello per un marketplace online.

Usa tutti i nuovi tools e features che hai imparato per creare un’applicazione con i seguenti requisiti:

– Una homepage che mostri tutti i libri con delle card di bootstrap
– Le card dovrebbero avere un pulsante per aggiungere al carrello e uno per “saltare” un prodotto
– Una sezione per il carrello
– Un input di testo per cercare i libri

Per raggiungere questo risultato, segui queste istruzioni:

– Usa questo API per ottenere la lista di libri: `https://striveschool-api.herokuapp.com/books`
– Renderizza tutti i libri usando i template literars and .forEach o .map
– Aggiungi il pulsante “aggiungi al carrello” a tutte le card
– Quando il pulsante viene cliccato…
1. Aggiungi il libro alla lista del carrello
2. cambia lo stile della card per mostrare che è già stata aggiunta (un bordo colorato o un badge vanno bene)
– Aggiungi un bottone “salta” a tutte le card
– Quando cliccato, questo bottone dovrebbe far sparire la card corrispondente.
– Aggiungi un input di testo che funzioni come una barra di ricerca. Quando l’utente scrive più di 3 caratteri, filtra il risultato dell’API per renderizzare solo i libri con un titolo che corrisponda, anche parzialmente, al contenuto dell’input. SUGGERIMENTO: usa .filter()
– Dai la possibilità all’utente di cancellare libri dal loro carrello
– Conta gli elementi nel carrello usando “.reduce()” e mostra il risultato nella sezione carrello

### EXTRA:

2. Aggiungi un pulsante per svuotare il carrello
3. Crea una pagine prodotto: quando l’utente clicca sul libro, deve essere portato ad un’altra pagine. Passa l’ASIN del libro come query nell’URL
4. Nella pagina prodotto, mostra i dettagli del libro con l’ASIN corrispondente usando questo endpoint: `https://striveschool-api.herokuapp.com/books/IL TUO ASIN QUI`-->
